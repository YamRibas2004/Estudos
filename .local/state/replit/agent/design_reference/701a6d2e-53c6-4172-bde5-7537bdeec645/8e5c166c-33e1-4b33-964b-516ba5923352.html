<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Rastreador de Estudos</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'inter': ['Inter', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#3B82F6',
                        'success': '#10B981',
                        'warning': '#EF4444',
                    }
                }
            }
        };
    </script>
</head>
<body class="font-inter bg-gray-50 min-h-screen">
    <!-- Header -->
    <header class="bg-primary text-white p-4 shadow-sm">
        <div class="max-w-7xl mx-auto flex items-center">
            <div class="w-6 h-6 bg-white rounded mr-3 flex items-center justify-center">
                <div class="w-4 h-4 bg-primary rounded"></div>
            </div>
            <div>
                <h1 class="text-xl font-semibold">Rastreador de Estudos</h1>
                <p class="text-blue-100 text-sm">Monitore seu progresso semanal</p>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto p-6 grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Column 1: Weekly Progress & Controls -->
        <div class="space-y-6">
            <!-- Weekly Progress -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Progresso da Semana Atual</h2>
                
                <!-- Weekly Glass -->
                <div class="text-center mb-4">
                    <div class="inline-block">
                        <svg width="80" height="120" viewBox="0 0 80 120" class="mx-auto">
                            <!-- Glass outline -->
                            <path d="M20 20 L60 20 L65 110 L15 110 Z" 
                                  fill="none" stroke="#E2E8F0" stroke-width="3"/>
                            <!-- Water fill -->
                            <path id="weeklyWaterFill" d="M20 110 L60 110 L60 110 L20 110 Z" 
                                  fill="#EF4444" opacity="0.8"/>
                            <!-- Glass shine -->
                            <path d="M25 25 L35 25 L37 105 L27 105 Z" 
                                  fill="white" opacity="0.3"/>
                        </svg>
                        <div class="mt-2 text-sm text-gray-600">
                            <span id="weeklyTimeDisplay">0min / 12h</span>
                        </div>
                        <div class="mt-1 text-xs text-gray-500">
                            <span id="weeklyPercentDisplay">0% da meta semanal alcançada</span>
                        </div>
                    </div>
                </div>

                <!-- Goals Display -->
                <div class="grid grid-cols-2 gap-3 mb-4">
                    <div class="bg-gray-50 rounded-lg p-3 text-center">
                        <div class="text-sm text-gray-600">Meta Semanal</div>
                        <div class="font-semibold text-gray-800">12h</div>
                    </div>
                    <div class="bg-gray-50 rounded-lg p-3 text-center">
                        <div class="text-sm text-gray-600">Meta Mensal</div>
                        <div class="font-semibold text-gray-800">48h</div>
                    </div>
                </div>
            </div>

            <!-- Controls -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Controles de Semana</h3>
                <div class="space-y-3">
                    <button id="add30MinBtn" class="w-full bg-primary text-white py-3 px-4 rounded-lg font-medium hover:bg-blue-600 transition-colors">
                        +30 Minutos
                    </button>
                    <button id="nextWeekBtn" class="w-full bg-gray-600 text-white py-3 px-4 rounded-lg font-medium hover:bg-gray-700 transition-colors">
                        Próxima Semana
                    </button>
                    <button id="newWeekBtn" class="w-full border border-gray-300 text-gray-700 py-3 px-4 rounded-lg font-medium hover:bg-gray-50 transition-colors">
                        Nova Semana
                    </button>
                </div>
            </div>
        </div>

        <!-- Column 2: Weekly Schedule -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">Cronograma Semanal</h2>
            
            <div class="bg-blue-50 rounded-lg p-3 mb-4 text-center">
                <span class="text-blue-700 font-medium" id="currentWeekDisplay">Semana 1</span>
            </div>

            <div class="space-y-3">
                <div class="flex items-center justify-between py-2 border-b border-gray-100" data-day="monday">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-3" id="monday-indicator"></div>
                        <span class="font-medium text-gray-700">Seg</span>
                    </div>
                    <span class="text-gray-600" id="monday-time">0min</span>
                </div>
                <div class="flex items-center justify-between py-2 border-b border-gray-100" data-day="tuesday">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-3" id="tuesday-indicator"></div>
                        <span class="font-medium text-gray-700">Ter</span>
                    </div>
                    <span class="text-gray-600" id="tuesday-time">0min</span>
                </div>
                <div class="flex items-center justify-between py-2 border-b border-gray-100" data-day="wednesday">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-3" id="wednesday-indicator"></div>
                        <span class="font-medium text-gray-700">Qua</span>
                    </div>
                    <span class="text-gray-600" id="wednesday-time">0min</span>
                </div>
                <div class="flex items-center justify-between py-2 border-b border-gray-100" data-day="thursday">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-3" id="thursday-indicator"></div>
                        <span class="font-medium text-gray-700">Qui</span>
                    </div>
                    <span class="text-gray-600" id="thursday-time">0min</span>
                </div>
                <div class="flex items-center justify-between py-2 border-b border-gray-100" data-day="friday">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-3" id="friday-indicator"></div>
                        <span class="font-medium text-gray-700">Sex</span>
                    </div>
                    <span class="text-gray-600" id="friday-time">0min</span>
                </div>
                <div class="flex items-center justify-between py-2 border-b border-gray-100" data-day="saturday">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-3" id="saturday-indicator"></div>
                        <span class="font-medium text-gray-700">Sáb</span>
                    </div>
                    <span class="text-gray-600" id="saturday-time">0min</span>
                </div>
                <div class="flex items-center justify-between py-2" data-day="sunday">
                    <div class="flex items-center">
                        <div class="w-3 h-3 rounded-full mr-3" id="sunday-indicator"></div>
                        <span class="font-medium text-gray-700">Dom</span>
                    </div>
                    <span class="text-gray-600" id="sunday-time">0min</span>
                </div>
            </div>
        </div>

        <!-- Column 3: Daily Progress & History -->
        <div class="space-y-6">
            <!-- Daily Progress -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h2 class="text-lg font-semibold text-gray-800 mb-4">Progresso Diário - <span id="currentMonthDisplay">Janeiro</span></h2>
                
                <div class="text-center mb-4">
                    <div class="text-sm text-gray-600 mb-2">
                        Meta mensal: 48 horas totais • Progresso atual: <span id="monthlyProgressDisplay">0.0h</span>
                    </div>
                </div>

                <!-- Daily Glasses Grid -->
                <div class="grid grid-cols-7 gap-2 mb-4">
                    <!-- These will be generated by JavaScript -->
                </div>

                <!-- Legend -->
                <div class="flex items-center justify-center space-x-4 text-xs">
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-success rounded-full mr-1"></div>
                        <span class="text-gray-600">Meta do Mês Atingida (6h+)</span>
                    </div>
                    <div class="flex items-center">
                        <div class="w-3 h-3 bg-warning rounded-full mr-1"></div>
                        <span class="text-gray-600">Meta do Mês Incompleta (&lt;6h)</span>
                    </div>
                </div>
            </div>

            <!-- Monthly Progress -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Progresso Mensal</h3>
                
                <div class="text-center mb-4">
                    <div class="inline-block">
                        <svg width="60" height="90" viewBox="0 0 60 90" class="mx-auto">
                            <!-- Glass outline -->
                            <path d="M15 15 L45 15 L50 80 L10 80 Z" 
                                  fill="none" stroke="#E2E8F0" stroke-width="2"/>
                            <!-- Water fill -->
                            <path id="monthlyWaterFill" d="M15 80 L45 80 L45 80 L15 80 Z" 
                                  fill="#EF4444" opacity="0.8"/>
                            <!-- Glass shine -->
                            <path d="M20 20 L25 20 L27 75 L22 75 Z" 
                                  fill="white" opacity="0.3"/>
                        </svg>
                        <div class="mt-2 text-sm text-gray-600">
                            <span id="monthlyTimeDisplay">0h / 48h</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Weekly History -->
            <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Resumo das Semanas - <span id="historyMonthDisplay">Janeiro</span></h3>
                
                <div id="weeklyHistoryList" class="space-y-2 mb-4">
                    <div class="text-sm text-gray-500">Nenhuma semana concluída ainda</div>
                </div>

                <div class="bg-gray-50 rounded-lg p-3 text-center">
                    <div class="text-sm text-gray-600">Total de <span id="totalMonthDisplay">Janeiro</span>:</div>
                    <div class="font-semibold text-gray-800" id="monthlyTotalDisplay">0min / 48h</div>
                    <div class="text-xs text-gray-500" id="monthlyTotalPercentDisplay">0% da meta mensal</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        (function() {
            // Data structure to store all study data
            let studyData = {
                currentWeek: 1,
                dailyMinutes: {}, // Format: 'YYYY-MM-DD': minutes
                weekHistory: [], // Last 2 weeks only
                monthlyTotal: 0,
                lastResetMonth: new Date().getMonth()
            };

            // Load data from localStorage
            function loadData() {
                const saved = localStorage.getItem('studyTrackerData');
                if (saved) {
                    studyData = { ...studyData, ...JSON.parse(saved) };
                }
                
                // Check if we need monthly reset
                const currentMonth = new Date().getMonth();
                if (studyData.lastResetMonth !== currentMonth) {
                    studyData.monthlyTotal = 0;
                    studyData.lastResetMonth = currentMonth;
                    // Clear daily data from previous months
                    const currentDate = new Date();
                    const currentMonthYear = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
                    const filteredDaily = {};
                    Object.keys(studyData.dailyMinutes).forEach(date => {
                        if (date.startsWith(currentMonthYear)) {
                            filteredDaily[date] = studyData.dailyMinutes[date];
                        }
                    });
                    studyData.dailyMinutes = filteredDaily;
                    saveData();
                }
            }

            // Save data to localStorage
            function saveData() {
                localStorage.setItem('studyTrackerData', JSON.stringify(studyData));
            }

            // Format time display
            function formatTime(minutes) {
                if (minutes === 0) return '0min';
                if (minutes < 60) return `${minutes}min`;
                
                const hours = Math.floor(minutes / 60);
                const remainingMinutes = minutes % 60;
                
                if (remainingMinutes === 0) return `${hours}h`;
                return `${hours}h${remainingMinutes}`;
            }

            // Get current date string
            function getCurrentDateString() {
                const now = new Date();
                return `${now.getFullYear()}-${String(now.getMonth() + 1).padStart(2, '0')}-${String(now.getDate()).padStart(2, '0')}`;
            }

            // Get current day of week (0 = Sunday, 1 = Monday, etc.)
            function getCurrentDayOfWeek() {
                const now = new Date();
                return now.getDay();
            }

            // Get day name from day index
            function getDayName(dayIndex) {
                const days = ['sunday', 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday'];
                return days[dayIndex];
            }

            // Get today's study minutes
            function getTodayMinutes() {
                const today = getCurrentDateString();
                return studyData.dailyMinutes[today] || 0;
            }

            // Get current week's total minutes
            function getCurrentWeekMinutes() {
                let total = 0;
                const today = new Date();
                const currentDay = today.getDay();
                
                // Calculate start of week (Monday)
                const monday = new Date(today);
                monday.setDate(today.getDate() - ((currentDay + 6) % 7));
                
                for (let i = 0; i < 7; i++) {
                    const date = new Date(monday);
                    date.setDate(monday.getDate() + i);
                    const dateString = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                    total += studyData.dailyMinutes[dateString] || 0;
                }
                
                return total;
            }

            // Get current month's total minutes
            function getCurrentMonthMinutes() {
                let total = 0;
                const currentDate = new Date();
                const currentMonthYear = `${currentDate.getFullYear()}-${String(currentDate.getMonth() + 1).padStart(2, '0')}`;
                
                Object.keys(studyData.dailyMinutes).forEach(date => {
                    if (date.startsWith(currentMonthYear)) {
                        total += studyData.dailyMinutes[date];
                    }
                });
                
                return total;
            }

            // Update water glass fill
            function updateWaterGlass(elementId, minutes, maxMinutes, isWeekly = false) {
                const element = document.getElementById(elementId);
                if (!element) return;

                const percentage = Math.min(minutes / maxMinutes, 1);
                const fillHeight = percentage * (isWeekly ? 90 : 65);
                const fillY = (isWeekly ? 110 : 80) - fillHeight;
                
                // Update fill path
                const pathParts = element.getAttribute('d').split(' ');
                const x1 = pathParts[1], x2 = pathParts[3];
                element.setAttribute('d', `M${x1} ${isWeekly ? 110 : 80} L${x2} ${isWeekly ? 110 : 80} L${x2} ${fillY} L${x1} ${fillY} Z`);
                
                // Update color
                const color = percentage >= 1 ? '#10B981' : '#EF4444';
                element.setAttribute('fill', color);
            }

            // Update day indicators
            function updateDayIndicators() {
                const days = ['monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'];
                const today = new Date();
                const currentDay = today.getDay();
                const monday = new Date(today);
                monday.setDate(today.getDate() - ((currentDay + 6) % 7));
                
                days.forEach((day, index) => {
                    const date = new Date(monday);
                    date.setDate(monday.getDate() + index);
                    const dateString = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                    const minutes = studyData.dailyMinutes[dateString] || 0;
                    
                    // Update time display
                    document.getElementById(`${day}-time`).textContent = formatTime(minutes);
                    
                    // Update indicator
                    const indicator = document.getElementById(`${day}-indicator`);
                    const isToday = index === ((currentDay + 6) % 7);
                    
                    if (isToday) {
                        indicator.className = 'w-3 h-3 rounded-full mr-3 bg-primary';
                    } else if (minutes >= 360) { // 6 hours
                        indicator.className = 'w-3 h-3 rounded-full mr-3 bg-success';
                    } else if (minutes > 0) {
                        indicator.className = 'w-3 h-3 rounded-full mr-3 bg-warning';
                    } else {
                        indicator.className = 'w-3 h-3 rounded-full mr-3 bg-gray-200';
                    }
                });
            }

            // Update all displays
            function updateDisplays() {
                const todayMinutes = getTodayMinutes();
                const weekMinutes = getCurrentWeekMinutes();
                const monthMinutes = getCurrentMonthMinutes();
                
                // Weekly display
                document.getElementById('weeklyTimeDisplay').textContent = `${formatTime(weekMinutes)} / 12h`;
                document.getElementById('weeklyPercentDisplay').textContent = `${Math.round((weekMinutes / 720) * 100)}% da meta semanal alcançada`;
                updateWaterGlass('weeklyWaterFill', weekMinutes, 720, true);
                
                // Monthly display
                document.getElementById('monthlyTimeDisplay').textContent = `${formatTime(monthMinutes)} / 48h`;
                document.getElementById('monthlyProgressDisplay').textContent = `${(monthMinutes / 60).toFixed(1)}h`;
                updateWaterGlass('monthlyWaterFill', monthMinutes, 2880);
                
                // Month names
                const monthNames = ['Janeiro', 'Fevereiro', 'Março', 'Abril', 'Maio', 'Junho', 
                                   'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                const currentMonth = monthNames[new Date().getMonth()];
                document.getElementById('currentMonthDisplay').textContent = currentMonth;
                document.getElementById('historyMonthDisplay').textContent = currentMonth;
                document.getElementById('totalMonthDisplay').textContent = currentMonth;
                
                // Monthly totals
                document.getElementById('monthlyTotalDisplay').textContent = `${formatTime(monthMinutes)} / 48h`;
                document.getElementById('monthlyTotalPercentDisplay').textContent = `${Math.round((monthMinutes / 2880) * 100)}% da meta mensal`;
                
                // Week display
                document.getElementById('currentWeekDisplay').textContent = `Semana ${studyData.currentWeek}`;
                
                // Update day indicators
                updateDayIndicators();
                
                // Update history
                updateWeeklyHistory();
            }

            // Update weekly history display
            function updateWeeklyHistory() {
                const historyList = document.getElementById('weeklyHistoryList');
                
                if (studyData.weekHistory.length === 0) {
                    historyList.innerHTML = '<div class="text-sm text-gray-500">Nenhuma semana concluída ainda</div>';
                } else {
                    historyList.innerHTML = studyData.weekHistory.map(week => `
                        <div class="flex items-center justify-between py-2 border-b border-gray-100">
                            <div class="flex items-center">
                                <div class="w-6 h-6 bg-blue-100 rounded-full flex items-center justify-center mr-3">
                                    <span class="text-xs font-medium text-blue-600">${week.weekNumber}</span>
                                </div>
                                <span class="font-medium text-gray-700">Semana ${week.weekNumber}</span>
                            </div>
                            <div class="text-right">
                                <div class="font-medium text-gray-800">${formatTime(week.totalMinutes)}</div>
                                <div class="text-xs text-gray-500">${Math.round((week.totalMinutes / 720) * 100)}% da meta</div>
                            </div>
                        </div>
                    `).join('');
                }
            }

            // Add 30 minutes to today
            function add30Minutes() {
                const today = getCurrentDateString();
                if (!studyData.dailyMinutes[today]) {
                    studyData.dailyMinutes[today] = 0;
                }
                studyData.dailyMinutes[today] += 30;
                saveData();
                updateDisplays();
            }

            // Start next week
            function nextWeek() {
                // Save current week to history
                const weekMinutes = getCurrentWeekMinutes();
                const weekData = {
                    weekNumber: studyData.currentWeek,
                    totalMinutes: weekMinutes
                };
                
                studyData.weekHistory.push(weekData);
                
                // Keep only last 2 weeks
                if (studyData.weekHistory.length > 2) {
                    studyData.weekHistory.shift();
                }
                
                // Increment week number
                studyData.currentWeek++;
                
                // Clear current week data
                const today = new Date();
                const currentDay = today.getDay();
                const monday = new Date(today);
                monday.setDate(today.getDate() - ((currentDay + 6) % 7));
                
                for (let i = 0; i < 7; i++) {
                    const date = new Date(monday);
                    date.setDate(monday.getDate() + i);
                    const dateString = `${date.getFullYear()}-${String(date.getMonth() + 1).padStart(2, '0')}-${String(date.getDate()).padStart(2, '0')}`;
                    delete studyData.dailyMinutes[dateString];
                }
                
                saveData();
                updateDisplays();
            }

            // Create new week (reset everything)
            function newWeek() {
                studyData.currentWeek = 1;
                studyData.dailyMinutes = {};
                studyData.weekHistory = [];
                saveData();
                updateDisplays();
            }

            // Initialize the app
            function init() {
                loadData();
                updateDisplays();
                
                // Event listeners
                document.getElementById('add30MinBtn').addEventListener('click', add30Minutes);
                document.getElementById('nextWeekBtn').addEventListener('click', nextWeek);
                document.getElementById('newWeekBtn').addEventListener('click', newWeek);
                
                // Update every minute to handle day changes
                setInterval(updateDisplays, 60000);
            }

            // Start the app when DOM is loaded
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', init);
            } else {
                init();
            }
        })();
    </script>
</body>
</html>